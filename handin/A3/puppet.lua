
-- A humanoid puppet.

-- Create all nodes.
root = gr.node('root')

torso = gr.node('torso')
shoulders = gr.node('shoulders')
neck = gr.joint('neck', {-20, 0, 20}, {0, 0, 0})
head = gr.joint('head', {-30, 0, 40}, {-90, 0, 90})

leftUpperArm = gr.joint('leftUpperArm', {-180, 0, 0}, {0, 0, 90})
rightUpperArm = gr.joint('rightUpperArm', {-180, 0, 0}, {-90, 0, 0})
leftForearm = gr.joint('leftForearm', {-140, 0, 0}, {0, 0, 0})
rightForearm = gr.joint('rightForearm', {-140, 0, 0}, {0, 0, 0})
leftHand = gr.joint('leftHand', {-30, 0, 30}, {0, 0, 180})
rightHand = gr.joint('rightHand', {-30, 0, 30}, {-180, 0, 0})

hips = gr.node('hips')
leftThigh = gr.joint('leftThigh', {-110, 0, 0}, {0, 0, 30})
rightThigh = gr.joint('rightThigh', {-110, 0, 0}, {-30, 0, 0})
leftCalf = gr.joint('leftCalf', {0, 0, 140}, {-20, 0, 20})
rightCalf = gr.joint('rightCalf', {0, 0, 140}, {-20, 0, 20})
leftFoot = gr.joint('leftFoot', {-30, 0, 30}, {0, 0, 0})
rightFoot = gr.joint('rightFoot', {-30, 0, 30}, {0, 0, 0})

-- Geometry for each node
torso_g = gr.sphere('torso_g')
shoulders_g = gr.sphere('shoulders_g')
neck_g = gr.sphere('neck_g')
head_g = gr.sphere('head_g')
left_eye_g = gr.sphere('left_eye_g')
right_eye_g = gr.sphere('right_eye_g')

leftUpperArm_g = gr.sphere('leftUpperArm_g')
rightUpperArm_g = gr.sphere('rightUpperArm_g')
leftForearm_g = gr.sphere('leftForearm_g')
rightForearm_g = gr.sphere('rightForearm_g')
leftHand_g = gr.sphere('leftHand_g')
rightHand_g = gr.sphere('rightHand_g')

hips_g = gr.sphere('hips_g')
leftThigh_g = gr.sphere('leftThigh_g')
rightThigh_g = gr.sphere('rightThigh_g')
leftCalf_g = gr.sphere('leftCalf_g')
rightCalf_g = gr.sphere('rightCalf_g')
leftFoot_g = gr.sphere('leftFoot_g')
rightFoot_g = gr.sphere('rightFoot_g')

-- Add geometries to joints.
torso:add_child(torso_g)
shoulders:add_child(shoulders_g)
neck:add_child(neck_g)
head:add_child(head_g)
head:add_child(left_eye_g)
head:add_child(right_eye_g)

leftUpperArm:add_child(leftUpperArm_g)
rightUpperArm:add_child(rightUpperArm_g)
leftForearm:add_child(leftForearm_g)
rightForearm:add_child(rightForearm_g)
leftHand:add_child(leftHand_g)
rightHand:add_child(rightHand_g)

hips:add_child(hips_g)
leftThigh:add_child(leftThigh_g)
rightThigh:add_child(rightThigh_g)
leftCalf:add_child(leftCalf_g)
rightCalf:add_child(rightCalf_g)
leftFoot:add_child(leftFoot_g)
rightFoot:add_child(rightFoot_g)

-- Build hierarchy.
root:add_child(torso)
  torso:add_child(shoulders)
    shoulders:add_child(leftUpperArm)
      leftUpperArm:add_child(leftForearm)
        leftForearm:add_child(leftHand)
    shoulders:add_child(neck)
      neck:add_child(head)
    shoulders:add_child(rightUpperArm)
      rightUpperArm:add_child(rightForearm)
        rightForearm:add_child(rightHand)
  torso:add_child(hips)
    hips:add_child(leftThigh)
      leftThigh:add_child(leftCalf)
        leftCalf:add_child(leftFoot)
    hips:add_child(rightThigh)
      rightThigh:add_child(rightCalf)
        rightCalf:add_child(rightFoot)

-- Apply transformations.
root:translate(0.0, 1.0, -5.0)

torso_g:scale(0.5, 1.5, 0.4)
hips:translate(0.0, -1.5, 0.0)
hips_g:scale(0.7, 0.25, 0.3)
shoulders:translate(0.0, 1.3, 0.0)
shoulders_g:scale(1.2, 0.22, 0.2)
neck:translate(0.0, 0.2, 0.0)
neck_g:translate(0.0, 0.1, 0.0)
neck_g:scale(0.1, 0.3, 0.1)
head:translate(0.0, 0.1, 0.0)
head_g:translate(0.0, 0.7, 0.0)
head_g:scale(0.5, 0.7, 0.4)

left_eye_g:translate(-0.25, 0.8, 0.38)
left_eye_g:scale(0.1, 0.1, 0.03)
right_eye_g:translate(0.25, 0.8, 0.38)
right_eye_g:scale(0.1, 0.1, 0.03)

leftUpperArm:translate(-1.0, 0.0, 0.0)
leftUpperArm_g:translate(0.0, -0.5, 0.0)
leftUpperArm_g:scale(0.16, 0.7, 0.16)
leftForearm:translate(0.0, -1.15, 0.0)
leftForearm_g:translate(0.0, -0.5, 0.0)
leftForearm_g:scale(0.16, 0.6, 0.16)
leftHand:translate(0.0, -1.0, 0.0)
leftHand_g:translate(0.0, -0.2, 0.0)
leftHand_g:scale(0.15, 0.18, 0.07)

rightUpperArm:translate(1.0, 0.0, 0.0)
rightUpperArm_g:translate(0.0, -0.5, 0.0)
rightUpperArm_g:scale(0.16, 0.7, 0.16)
rightForearm:translate(0.0, -1.15, 0.0)
rightForearm_g:translate(0.0, -0.5, 0.0)
rightForearm_g:scale(0.16, 0.6, 0.16)
rightHand:translate(0.0, -1.0, 0.0)
rightHand_g:translate(0.0, -0.2, 0.0)
rightHand_g:scale(0.15, 0.18, 0.07)

leftThigh:translate(-0.5, 0.0, 0.0)
leftThigh_g:translate(0.0, -1.0, 0.0)
leftThigh_g:scale(0.22, 1.0, 0.22)
leftCalf:translate(0.0, -2.0, 0.0)
leftCalf_g:translate(0.0, -0.75, 0.0)
leftCalf_g:scale(0.18, 0.8, 0.18)
leftFoot:translate(0.0, -1.45, 0.0)
leftFoot_g:translate(0.0, -0.05, 0.4)
leftFoot_g:scale(0.13, 0.08, 0.4)

rightThigh:translate(0.5, 0.0, 0.0)
rightThigh_g:translate(0.0, -1.0, 0.0)
rightThigh_g:scale(0.22, 1.0, 0.22)
rightCalf:translate(0.0, -2.0, 0.0)
rightCalf_g:translate(0.0, -0.75, 0.0)
rightCalf_g:scale(0.18, 0.8, 0.18)
rightFoot:translate(0.0, -1.45, 0.0)
rightFoot_g:translate(0.0, -0.05, 0.4)
rightFoot_g:scale(0.13, 0.08, 0.4)


-- All materials.
red = gr.material({1.0, 0.0, 0.0}, {0.1, 0.1, 0.1}, 10)
blue = gr.material({0.0, 0.0, 1.0}, {0.1, 0.1, 0.1}, 10)
green = gr.material({0.0, 1.0, 0.0}, {0.1, 0.1, 0.1}, 10)
white = gr.material({1.0, 1.0, 1.0}, {0.1, 0.1, 0.1}, 10)
c1 = gr.material({1.0, 1.0, 0.0}, {0.1, 0.1, 0.1}, 10)
c2 = gr.material({0.0, 1.0, 1.0}, {0.1, 0.1, 0.1}, 10)
c3 = gr.material({1.0, 0.0, 1.0}, {0.1, 0.1, 0.1}, 10)
c4 = gr.material({0.8, 0.4, 0.2}, {0.1, 0.1, 0.1}, 10)

-- Apply materials.
torso_g:set_material(green)
hips_g:set_material(green)
neck_g:set_material(red)
head_g:set_material(red)
left_eye_g:set_material(white)
right_eye_g:set_material(white)
shoulders_g:set_material(blue)
leftUpperArm_g:set_material(c1)
leftForearm_g:set_material(c1)
leftHand_g:set_material(c1)
rightUpperArm_g:set_material(c2)
rightForearm_g:set_material(c2)
rightHand_g:set_material(c2)
leftThigh_g:set_material(c3)
leftCalf_g:set_material(c3)
leftFoot_g:set_material(c3)
rightThigh_g:set_material(c4)
rightCalf_g:set_material(c4)
rightFoot_g:set_material(c4)

return root

